'use strict';var e=this;
function f(d){var l=d&&"object"===typeof d&&"default"in d?d:{"default":d},g;(function(a){a.VP8="vp8";a.VP9="vp9";a.Opus="Opus";a.iSAC="isac";a.iLBC="ilbc";a.H264="h264"})(g||(g={}));var c;(function(a){a.error="error";a.paused="paused";a.started="started";a.stopped="stopped"})(c||(c={}));const h={codecs:g.u,format:"webm",fps:60};class k{constructor(a,b=h){this.o=()=>{this.i=new MediaSource;this.h=this.canvas.captureStream(this.options.fps);return this};this.canvas=a;this.resetOptions(b)}clearSourceBuffer(){if(this.i){const a=this.i.sourceBuffers;
for(let b=0;b<a.length;b++)this.i.removeSourceBuffer(a[b])}return this}clearSteam(){if(this.h){const a=this.h.getTracks();for(let b=0;b<a.length;b++)a[b].enabled=!1,a[b].stop(),this.h.removeTrack(a[b])}return this}destroy(){this.clearSourceBuffer().clearSteam();this.j=[];return this}download(a="untitled_"+(new Date).getTime()){l["default"].download(this.getBlob(),a);return this}getBlob(){return new Blob(this.j,{type:"video/"+this.options.format})}getUrl(){return window.URL.createObjectURL(this.getBlob())}pause(){this.state===
c.l&&this.g&&(this.g.pause(),this.state=c.paused);return this}resetOptions(a){this.options={...h,...a};return this.destroy().o()}resume(){this.state===c.paused&&this.g&&(this.g.resume(),this.state=c.l);return this}start(a=100){this.j=[];this.g=this.g||this.m();if(!this.g)return this.state=c.error,this;this.g.ondataavailable=b=>{b.data&&0<b.data.size&&this.j.push(b.data)};this.g.start(a);this.state=c.l;return this}stop(){this.state=c.stopped;this.g&&this.g.stop();return this}toggle(){this.state===
c.stopped?this.start():this.state===c.l?this.stop():this.state===c.paused&&this.resume();return this}m(){var a=this.options.format;const b={mimeType:"video/"+a+";codecs="+this.options.codecs};a={mimeType:"video/"+a};return MediaRecorder.isTypeSupported(b.mimeType)?new MediaRecorder(this.h,b):MediaRecorder.isTypeSupported(a.mimeType)?new MediaRecorder(this.h,a):!1}}k.isAvaliable=a=>!!MediaSource&&!!a.captureStream;return k}
"object"===typeof exports&&"undefined"!==typeof module?module.exports=f(require("@valeera/blobdownloader")):"function"===typeof define&&define.v?define(["@valeera/blobdownloader"],f):(e="undefined"!==typeof globalThis?globalThis:e||self,e.WebRTCRecorder=f(e.s));
